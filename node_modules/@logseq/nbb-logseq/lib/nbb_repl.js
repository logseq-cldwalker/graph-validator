import * as esm_import$readline from "readline";
import * as esm_import$vm from "vm";
import { $APP, shadow$provide, $jscomp } from "./nbb_api.js";
import  "./nbb_core.js";
const shadow_esm_import = function(x) { return import(x) };
'use strict';var BU=function(a){var b=function(){var e=$APP.Ts.h(a,"(");return $APP.k(e)?new $APP.H(null,2,5,$APP.I,[$APP.Ek.j(a,0,e+1),$APP.Ek.h(a,e+1)],null):new $APP.H(null,2,5,$APP.I,[null,a],null)}(),c=$APP.B.j(b,0,null),d=$APP.B.j(b,1,null);b=$APP.af.h(function(){try{return $APP.zBa(new $APP.h(null,3,[$APP.$S,$APP.Zx,$APP.R,$APP.n.g($APP.p(AU)),$APP.tJ,d],null))}catch(f){var e=f;console.warn($APP.n.g($APP.uva),$APP.jm(e));return null}}(),"completions");return $APP.Mk.h(function(e){return[$APP.n.g(c),
$APP.n.g(e)].join("")},$APP.ji(function(e){return 0==e.lastIndexOf(d,0)},$APP.Mk.h(function(e){return $APP.af.h(e,"candidate")},b)))},bEa=function(a){return[$APP.ks.g(BU(a)),a]},FU=function(a,b){$APP.Nh(CU,!1);a.setPrompt([$APP.n.g($APP.p(AU)),"\x3d\x3e "].join(""));a.prompt();return $APP.vn($APP.p(DU))?null:EU.h?EU.h(b,a):EU.call(null,b,a)},cEa=function(a){var b=$APP.Mn(a);a=$APP.Nn(a);var c=$APP.pn($APP.p(DU));b=$APP.Sh.h(b-1,c);c=$APP.u(b);b=$APP.v(c);c=$APP.y(c);a=$APP.k(b)?$APP.Ek.h(b,a):null;
$APP.Nh(DU,$APP.mr.h("\n",$APP.zg(a,c)))},dEa=function(a,b){b={f:b};GU.createContext(b);try{return $APP.k($APP.k(HU)?$APP.lb(a):HU)&&process.stdin.setRawMode(!1),GU.runInContext("f()",b,{displayErrors:!0,breakOnSigint:!0,microtaskMode:"afterEvaluate"}).then(function(c){var d={f:$APP.k(a)?function(){return c}:function(){var e=$APP.v(c);$APP.cE.l($APP.D([e]));return c}};GU.createContext(d);return GU.runInContext("f()",d,{displayErrors:!0,breakOnSigint:!0,microtaskMode:"afterEvaluate"})}).finally(function(){return $APP.k($APP.k(HU)?
$APP.lb(a):HU)?process.stdin.setRawMode(!0):null})}catch(c){return b=c,$APP.k($APP.k(HU)?$APP.lb(a):HU)&&process.stdin.setRawMode(!0),Promise.reject(b)}},EU=function(a,b){if($APP.k(function(){var e=$APP.p(CU);return $APP.k(e)?e:$APP.vn($APP.p(DU))}()))return null;$APP.Nh(CU,!0);var c=$APP.Aw($APP.p(DU)),d=function(){try{var e=$APP.gh([$APP.cs,$APP.p(AU)]);$APP.Pr(e);try{return $APP.ky(c)}finally{$APP.Rr()}}catch(f){e=f;if(-1!=$APP.jm(e).indexOf("EOF while reading"))return eEa;cEa(c);$APP.cE.l($APP.D([$APP.n.g(e)]));
return fEa}}();if($APP.z.h(fEa,d))return FU(b,a);if($APP.z.h(eEa,d))return $APP.Nh(CU,!1);cEa(c);if($APP.z.h($APP.jy,d))return $APP.Nh(CU,!1);$APP.Pr($APP.gh([$APP.cs,$APP.p(AU)]));return dEa(a,function(){return $APP.my(null,null,new $APP.h(null,2,[$APP.Ay,$APP.fv,$APP.yy,function(){var e=$APP.tl.g(!1);return function(){return $APP.lb($APP.p(e))?($APP.Nh(e,!0),d):$APP.jy}}()],null))}).then(function(e){var f=new $APP.H(null,2,5,$APP.I,[$APP.v(e),$APP.Qx($APP.p($APP.Zx),$APP.hy)],null);e=$APP.B.j(f,
0,null);f=$APP.B.j(f,1,null);$APP.Nh(AU,f);$APP.UQ.h($APP.JQ,$APP.Lh($APP.p($APP.IQ)));$APP.UQ.h($APP.IQ,$APP.Lh($APP.p($APP.HQ)));$APP.UQ.h($APP.HQ,$APP.Lh(e));$APP.k(a)&&a.write($APP.ZD.l($APP.D([e])));return FU(b,a)}).catch(function(e){$APP.cE.l($APP.D([$APP.n.g(e)]));$APP.UQ.h($APP.KQ,$APP.Lh(e));return FU(b,a)}).finally(function(){return $APP.Rr()})},gEa=function(a,b){a.on("line",function(c){$APP.ul.I(DU,$APP.n,c,"\n");return EU(b,a)})},iEa=function(a){return hEa.createInterface({input:a,output:a,
completer:bEa})},jEa=function(a){var b=iEa(a);gEa(b,a);a.setNoDelay(!0);return a.on("close",function(){return $APP.bE.l($APP.D(["Client closed connection."]))})},kEa=new $APP.r(null,"get-completions","get-completions",1933789168,null),lEa=new $APP.r("nbb.impl.repl","completer*","nbb.impl.repl/completer*",455172317,null),mEa=new $APP.r(null,"completer*","completer*",-648150376,null),IU=new $APP.r(null,"_opts","_opts",1634624069,null),nEa=new $APP.r("nbb.impl.repl","repl","nbb.impl.repl/repl",-1645296655,
null),fEa=new $APP.G("nbb.impl.repl","continue","nbb.impl.repl/continue",-1326808644),JU=new $APP.r(null,"nbb.impl.repl","nbb.impl.repl",-339140484,null),eEa=new $APP.G("nbb.impl.repl","eof-while-reading","nbb.impl.repl/eof-while-reading",1743626215),oEa=new $APP.r("nbb.impl.repl","socket-repl","nbb.impl.repl/socket-repl",1509490200,null);var hEa=esm_import$readline;var GU=esm_import$vm;var AU=$APP.tl.g($APP.p($APP.cs)),DU=$APP.tl.g(""),CU=$APP.tl.g(!1),HU,pEa=process.stdout.isTTY;HU=$APP.k(pEa)?process.stdin.setRawMode:pEa;process.binding("contextify");var KU=$APP.Px($APP.zJ),LU=function LU(a){switch(arguments.length){case 0:return LU.F();case 1:return LU.g(arguments[0]);default:throw Error(["Invalid arity: ",$APP.n.g(arguments.length)].join(""));}};LU.F=function(){return LU.g(null)};
LU.g=function(a){var b=function(){var d=$APP.dT.g(a);return $APP.k(d)?d:0}(),c=$APP.CBa.createServer(jEa);return c.listen(b,"127.0.0.1",function(){var d=c.address(),e=d.address;return $APP.bE.l($APP.D([["Socket REPL listening on port ",$APP.n.g(d.port)," on host ",$APP.n.g(e)].join("")]))})};LU.C=1;var MU=function MU(a){switch(arguments.length){case 0:return MU.F();case 1:return MU.g(arguments[0]);default:throw Error(["Invalid arity: ",$APP.n.g(arguments.length)].join(""));}};MU.F=function(){return MU.g(null)};
MU.g=function(){function a(d){return $APP.rBa(new $APP.F(null,$APP.Em,new $APP.F(null,new $APP.F(null,$APP.Em,new $APP.F(null,d,null,1,null),2,null),null,1,null),2,null))}$APP.k(HU)&&process.stdin.setRawMode(!0);var b=$APP.B.j($APP.XQ,0,null),c=$APP.B.j($APP.XQ,1,null);$APP.bE.l($APP.D([["Welcome to nbb v",$APP.Wy(),"!"].join("")]));return a(b).then(function(){return a(c)}).then(function(){return new Promise(function(d){var e=$APP.k(null)?iEa(null):hEa.createInterface({input:process.stdin,output:process.stdout,
completer:bEa});gEa(e,null);e.setPrompt([$APP.n.g($APP.p(AU)),"\x3d\x3e "].join(""));e.on("close",d);return e.prompt()})})};MU.C=1;
var qEa=new $APP.h(null,3,[$APP.eT,function(){var a=new $APP.zd(function(){return MU},nEa,$APP.Ij([$APP.R,$APP.Q,$APP.mo,$APP.rC,$APP.EL,$APP.rp,$APP.no,$APP.sC,$APP.T,$APP.W,$APP.tC],[JU,$APP.eT,"nbb/impl/repl.cljs",11,new $APP.h(null,6,[$APP.UJ,!1,$APP.kt,1,$APP.qL,1,$APP.nG,new $APP.H(null,2,5,$APP.I,[$APP.ii,new $APP.H(null,1,5,$APP.I,[IU],null)],null),$APP.T,$APP.M($APP.ii,new $APP.H(null,1,5,$APP.I,[IU],null)),$APP.iI,$APP.M(null,null)],null),1,198,198,$APP.M($APP.ii,new $APP.H(null,1,5,$APP.I,
[IU],null)),null,$APP.k(MU)?MU.A:null])),b=$APP.p(a);a=$APP.we(a);var c=$APP.k(null)?null:$APP.Q.g(a),d=new $APP.h(null,4,[$APP.R,KU,$APP.Q,c,$APP.T,$APP.T.g(a),$APP.W,$APP.W.g(a)],null);return $APP.k($APP.Or.g(a))?$APP.Kx(c,b,d):$APP.k($APP.xs.g(a))?$APP.Lx(c,b,d):$APP.Jx(c,b,d)}(),kEa,function(){var a=new $APP.zd(function(){return BU},lEa,$APP.Ij([$APP.R,$APP.Q,$APP.mo,$APP.rC,$APP.rp,$APP.no,$APP.sC,$APP.T,$APP.W,$APP.tC],[JU,mEa,"nbb/impl/repl.cljs",17,1,15,15,$APP.M(new $APP.H(null,1,5,$APP.I,
[$APP.mma],null)),"Given a line, returns a flat vector of completions",$APP.k(BU)?BU.A:null])),b=$APP.p(a);a=$APP.we(a);var c=$APP.k(null)?null:$APP.Q.g(a),d=new $APP.h(null,4,[$APP.R,KU,$APP.Q,c,$APP.T,$APP.T.g(a),$APP.W,$APP.W.g(a)],null);return $APP.k($APP.Or.g(a))?$APP.Kx(c,b,d):$APP.k($APP.xs.g(a))?$APP.Lx(c,b,d):$APP.Jx(c,b,d)}(),$APP.cT,function(){var a=new $APP.zd(function(){return LU},oEa,$APP.Ij([$APP.R,$APP.Q,$APP.mo,$APP.rC,$APP.EL,$APP.rp,$APP.no,$APP.sC,$APP.T,$APP.W,$APP.tC],[JU,$APP.cT,
"nbb/impl/repl.cljs",18,new $APP.h(null,6,[$APP.UJ,!1,$APP.kt,1,$APP.qL,1,$APP.nG,new $APP.H(null,2,5,$APP.I,[$APP.ii,new $APP.H(null,1,5,$APP.I,[$APP.BM],null)],null),$APP.T,$APP.M($APP.ii,new $APP.H(null,1,5,$APP.I,[$APP.BM],null)),$APP.iI,$APP.M(null,null)],null),1,183,183,$APP.M($APP.ii,new $APP.H(null,1,5,$APP.I,[$APP.BM],null)),null,$APP.k(LU)?LU.A:null])),b=$APP.p(a);a=$APP.we(a);var c=$APP.k(null)?null:$APP.Q.g(a),d=new $APP.h(null,4,[$APP.R,KU,$APP.Q,c,$APP.T,$APP.T.g(a),$APP.W,$APP.W.g(a)],
null);return $APP.k($APP.Or.g(a))?$APP.Kx(c,b,d):$APP.k($APP.xs.g(a))?$APP.Lx(c,b,d):$APP.Jx(c,b,d)}()],null);try{$APP.Gy(new $APP.h(null,1,[$APP.qs,new $APP.h(null,1,[$APP.zJ,qEa],null)],null))}catch(a){throw console.error("An error occurred when calling (nbb.impl.repl/init)"),a;};
export { $APP, shadow$provide, $jscomp };
